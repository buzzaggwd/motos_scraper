# Парсер данных о мотоциклах
Проект представляет собой набор пауков (spiders) на scrapy для сбора информации о мотоциклах с четырех различных веб-сайтов (bikez.com, fastestlaps.com, webike.com.ru, motorcyclespecs.co.za). Данные сохраняются в sqlite базу данных.

## Цель проекта
Найти максимум данных о моделях мотоциклов из исходного файла motos.json, используя парсинг нескольких специализированных источников.

## Источники данных
#### BikezSpider (bikez.com):
Ищет модели по марке и названию модели.
Извлекает объем, мощность, крутящий момент двигателя, тип коробки передач, вес, емкость бака и другие данные из технических характеристик на странице модели.

#### FastestlapsSpider (fastestlaps.com):
Ищет модели по бренду и названию.
Проверяет, является ли транспортное средство мотоциклом, перед парсингом. 
Для корректной работы паука необходимо использование прокси, поскольку сайт блокирует частые запросы. 
В проекте настроена ротация прокси для пауков FastestlapsSpider и CseSpider.
Прокси берутся из файла proxies.txt.
Файл должен содержать список прокси в формате:
```
ip:port:login:password
```
где:
- ip - IP-адрес прокси-сервера
- port - порт прокси-сервера
- login - логин для аутентификации на прокси-сервере
- password - пароль для аутентификации на прокси-сервере

#### WebikeSpider (japan-webike.nl):
Ищет модели по бренду в каталоге магазина.
Парсит страницы с техническими характеристиками и оттуда все данные о модели.

#### CseSpider (motorcyclespecs.co.za):
Используется для моделей, которые не были найдены на предыдущих сайтах.
Парсинг частично происходит через Google Custom Search Engine, 
поэтому также нуждается в прокси для обхода капчи, которую периодически выдает поисковик.
Использует playwright для рендеринга js-элементов страницы поиска.
Переходит по первой найденной ссылке и пытается найти мощность двитателя.
Имейте ввиду, что при запуске конкретно этого паука происходит проверка прокси на работоспособность, 
поэтому он может немного задержать запуск остальных пауков.

## Стек технологий
- Python
- Scrapy
- BeautifulSoup4
- Playwright
- Sqlite3
- Loguru

## Запуск парсера

Клонируйте репозиторий:

```
git clone https://github.com/buzzaggwd/motos_scraper.git
```

Активируйте виртуальную среду:
```
python -m venv venv
venv\Scripts\activate
```

Установите зависимости:
```
pip install -r requirements.txt
```

Установите браузер для playwright:
```
playwright install chromium
```

Подготовьте исходные данные:

- Убедитесь, что в корне проекта существует файл motos.json со списком моделей мотоциклов, которые нужно обновить.

- Формат файла: список словарей, каждый из которых содержит ключи "api_id", "brand", "model" и "year" с айди, маркой, моделью и годом выпуска мотоцикла в качестве значения. Все названия обязательно на английском языке.

```
[
  {
    "api_id": "1079114745",
    "brand": "Honda",
    "model": "CBR1000RR",
    "year": 2014
  },
  {
    "api_id": "1057867100",
    "brand": "Yamaha",
    "model": "YZF-R1",
    "year": 2007
  },
  ...
]
```
- Мотоциклы могут быть только марок "Honda", "Kawasaki", "Harley-Davidson", "BMW", "Yamaha", "KTM", "Suzuki", "Triumph", "Ducati" или "Buell", иначе поиск будет неэффктивным.

Перейдите в нужную директорию:

```
cd motos_scraper/motos_scraper
```

Запустите парсер:
```
python main.py
```

## Запуск разных пауков
В файле main.py есть возможность запустить разные пауки отдельно.
Для этого раскомментируйте нужных пауков среди строк 46-49 и закомментируйте остальных.

## Запись в разные БД
Для записи найденных данных в разные БД, необходимо раскомментировать строки 14-16 в файле pipelines.py и закомментировать строку 19.
Затем в файле main.py закомментировать 55-67 и раскомментировать 71-92.
В таком случае мотоциклы будут записываться в базы, соответствующие названиям пауков (motos_bikez_spider.db, motos_fastestlaps_spider.db, motos_webike_spider.db, motos_cse_spider.db).
По умолчанию все данные записываются в одну общую БД motos.db.

## Собираемые данные
- api_id - идентификатор модели в исходном json-файле (должен быть уникальным)
- source - сайт, с которого был получен мотоцикл
- source_url - ссылка на мотоцикл
- brand - марка (берется из json)
- model - модель (берется из json)
- year - год выпуска (берется из json)
- category - категория мотоцикла
- origin_country - страна производитель
- engine_type - тип двигателя
- engine_displacement_cc - объем двигателя, см3
- engine_power_hp - мощность, лошадиных сил
- engine_power_rpm - обороты макс мощности
- engine_torque_nm - крутящий момент, Нм
- engine_torque_rpm - обороты макс крутящего момента
- gearbox - тип коробки передач
- transmission_clutch - тип сцепления
- transmission_type - тип привода
- abs_type - тип АБС
- dry_weight_kg - сухой вес, кг
- wet_weight_kg - снаряженный вес, кг
- fuel_capacity_l - емкость бака, литры
- top_speed_kph - макс. скорость, км/ч
- fuel_consumption_l_per_100km - расход топлива, л/100км

По умолчанию насроен фильтр сбора только тех мотоциклов, у которых удалось найти мощность двигателя. 
Чтобы собирать мотоциклы без мощности, внесите следующие правки: 
1. В файле bikez_spider.py раскомментируйте строки 253-255 и закомментируйте 243-250.
2. В файле fastestlaps_spider.py раскомментируйте строки 235-237 и закомментируйте 225-231.
3. В файле webike_spider.py раскомментируйте строки 212-214 и закомментируйте 202-209.
4. В файле cse_spider.py раскомментируйте строки 288-290 и закомментируйте 278-284.

## Заметки
Логирование: Процесс парсинга подробно логируется в два файла (файлы появятся после запуска проекта): 
scrapy.log и statistics.log, оба во внутренней папке motos_scraper. 
В первом подробные логи о каждом найденном мотоцикле, во втором общая статистика.
Если хотите видеть вывод подробных логов в терминал, раскомментируйте строку 140 в файле settings.py.
Если хотите убрать вывод статистических логов из терминала, закомментируйте строки 16, 19, 22, 25, 28 в файле main.py.




— buzzaggwd